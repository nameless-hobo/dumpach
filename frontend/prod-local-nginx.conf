upstream back_host {
    server backend:3000;
}

limit_req_zone $binary_remote_addr zone=mylimit:10m rate=20r/s;

server {
    listen 80;
    # NOTE: update client_max_body_size after videos upload made
    client_max_body_size 10m;
    server_name dumpach.shitcunt.info;
    root /etc/nginx/html;
    index index.html;

    gzip on;
    gzip_min_length 10240;
    gzip_proxied expired no-cache no-store private auth;
    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml;
    gzip_disable "msie6";

    location /api {
        limit_req zone=mylimit burst=50;
        proxy_pass http://back_host;
        proxy_set_header Host            $host;
        proxy_set_header X-Forwarded-For $remote_addr;
    }

    location / {
        limit_req zone=mylimit burst=50;
        try_files $uri /index.html;
    }

    proxy_connect_timeout       600;
    proxy_send_timeout          600;
    proxy_read_timeout          600;
    send_timeout                600;
}
